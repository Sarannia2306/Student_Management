<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="d-flex flex-column min-vh-100">
    <!-- App Container -->
    <div id="app" class="d-flex flex-column flex-grow-1">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="#">Student Management</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="dashboard">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="profile">My Profile</a>
                        </li>
                        <li class="nav-item admin-only">
                            <a class="nav-link" href="#" data-page="students">Students</a>
                        </li>
                        <li class="nav-item admin-only">
                            <a class="nav-link" href="#" data-page="programs">Programs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="attendance">Attendance</a>
                        </li>
                        <li class="nav-item student-only">
                            <a class="nav-link" href="#" data-page="announcements">Announcements</a>
                        </li>
                        <li class="nav-item admin-only">
                            <a class="nav-link" href="#" data-page="logs">Activity Logs</a>
                        </li>
                    </ul>
                    <div class="d-flex">
                        <span class="navbar-text me-3" id="userGreeting"></span>
                        <button class="btn btn-outline-light me-2" id="loginBtn">Login</button>
                        <button class="btn btn-outline-light" id="logoutBtn" style="display:none;">Logout</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-4" id="mainContent">
            <!-- Content will be loaded here dynamically -->
            <div class="text-center my-5">
                <h2>Welcome to Student Management System</h2>
                <p class="lead">Please log in to continue</p>
            </div>
        </div>
    </div>

    <!-- Terms & Conditions Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title" id="termsModalLabel">Terms and Conditions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6 class="mb-2">1. Purpose of the System</h6>
                    <p>This Student Management System is developed for educational and administrative purposes within the institution. It allows students and administrators to manage academic records, attendance, and related information efficiently.</p>

                    <h6 class="mb-2">2. User Responsibility</h6>
                    <p>Users must provide accurate and complete information during registration. Each user is responsible for maintaining the confidentiality of their login credentials. Sharing or misusing another userâ€™s credentials is strictly prohibited.</p>

                    <h6 class="mb-2">3. Data Protection and Privacy</h6>
                    <p>All personal and academic information is securely stored using Firebase Authentication and Database services, which provide encryption and secure HTTPS communication.</p>
                    <p>This system adheres to the Personal Data Protection Act (PDPA) 2010 (Malaysia) and follows basic data protection principles.</p>
                    <p>All collected data is used only for academic and administrative purposes and will not be shared, sold, or disclosed to any third parties without consent.</p>

                    <h6 class="mb-2">4. Access Control</h6>
                    <p>Access to this system is role-based. Students may view and update their own profile information. Administrators are authorized to manage student records, programs, attendance, and activity logs. Unauthorized access or attempts to bypass security measures are strictly prohibited and may result in access termination.</p>

                    <h6 class="mb-2">5. Security Measures</h6>
                    <ul>
                        <li>Secure login and authentication using Firebase</li>
                        <li>Email verification for user validation</li>
                        <li>Role-based access control (Admin / Student)</li>
                        <li>Input validation and data sanitization</li>
                        <li>Activity logging to monitor important user actions</li>
                    </ul>
                    <p>Users are advised to log out after using the system, especially on shared or public devices.</p>

                    <h6 class="mb-2">6. System Usage Policy</h6>
                    <p>Users agree to use the system ethically and responsibly. Any misuse, unauthorized modification, or malicious activity (such as attempting to access admin pages without permission) is strictly prohibited.</p>

                    <h6 class="mb-2">7. Disclaimer</h6>
                    <p>This system is developed for educational purposes only. While all reasonable security measures have been implemented, the institution and developers are not liable for any data loss or misuse resulting from unauthorized access or external attacks.</p>

                    <h6 class="mb-2">8. Acceptance of Terms</h6>
                    <p>By registering or logging in, you acknowledge that you have read, understood, and agreed to abide by these Terms and Conditions, and consent to the collection and use of your information in accordance with this policy.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Login to Your Account</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4 text-center">
                        <div class="btn-group auth-toggle" role="group">
                            <input type="radio" class="btn-check" name="loginType" id="studentLogin" autocomplete="off" checked>
                            <label class="btn" for="studentLogin">
                                <i class="fas fa-user-graduate me-2"></i>Student
                            </label>
                            
                            <input type="radio" class="btn-check" name="loginType" id="adminLogin" autocomplete="off">
                            <label class="btn" for="adminLogin">
                                <i class="fas fa-user-shield me-2"></i>Admin
                            </label>
                        </div>
                    </div>
                    
                    <form id="loginForm" novalidate>
                        <!-- Student Login Fields -->
                        <div id="studentLoginFields">
                            <div class="mb-3">
                                <label for="studentEmail" class="form-label">Student Email</label>
                                <input type="email" class="form-control" id="studentEmail" required>
                            </div>
                            <div class="mb-4">
                                <label for="studentPassword" class="form-label">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="studentPassword" required>
                                    <button class="btn btn-outline-secondary toggle-password" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <a href="#" id="forgotStudentPwd" class="small">Forgot password?</a>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Login Fields (initially hidden) -->
                        <div id="adminLoginFields" style="display: none;">
                            <div class="mb-3">
                                <label for="adminEmail" class="form-label">Admin Email</label>
                                <input type="email" class="form-control" id="adminEmail">
                            </div>
                            <!-- Hidden Admin ID storage, value is provided via prompt in auth.js -->
                            <input type="hidden" id="adminIdCode">
                            <div class="mb-4">
                                <label for="adminPassword" class="form-label">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="adminPassword">
                                    <button class="btn btn-outline-secondary toggle-password" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="mt-2">
                                    <a href="#" id="forgotAdminPwd" class="small">Forgot password?</a>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">Remember me</label>
                        </div>
                        <div class="mb-2">
                            <small class="text-muted">
                                <a href="#" class="text-decoration-underline" data-bs-toggle="modal" data-bs-target="#termsModal">View Terms and Conditions</a>
                            </small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </button>
                        
                        <div class="text-center mt-3">
                            <span id="registerPrompt">Don't have an account? </span>
                            <a href="#" id="showRegister" class="text-decoration-none">Register here</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Create an Account</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4 text-center">
                        <div class="btn-group auth-toggle" role="group">
                            <input type="radio" class="btn-check" name="registerType" id="studentRegister" autocomplete="off" checked>
                            <label class="btn" for="studentRegister">
                                <i class="fas fa-user-graduate me-2"></i>Student
                            </label>
                            
                            <input type="radio" class="btn-check" name="registerType" id="adminRegister" autocomplete="off">
                            <label class="btn" for="adminRegister">
                                <i class="fas fa-user-shield me-2"></i>Admin
                            </label>
                        </div>
                    </div>

                    <!-- Student Registration Form -->
                    <form id="studentRegisterForm">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="studentFullName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="studentFullName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="studentRegEmail" class="form-label">Student Email</label>
                                <input type="email" class="form-control" id="studentRegEmail" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="studentPhone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="studentPhone" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="studentIC" class="form-label">IC Number</label>
                                <input type="text" class="form-control" id="studentIC" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="studentRegPassword" class="form-label">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="studentRegPassword" required>
                                    <button class="btn btn-outline-secondary toggle-password" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="form-text">
                                    <ul class="list-unstyled mb-0 small text-muted ps-3">
                                        <li id="studentPwdHintLen" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Minimum 8 characters
                                        </li>
                                        <li id="studentPwdHintUpper" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Must include 1 uppercase
                                        </li>
                                        <li id="studentPwdHintNum" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Must include 1 number
                                        </li>
                                        <li id="studentPwdHintSpecial" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Must include 1 special character
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="confirmStudentPassword" class="form-label">Confirm Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="confirmStudentPassword" required>
                                    <button class="btn btn-outline-secondary toggle-password" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="studentAgree">
                            <label class="form-check-label" for="studentAgree">I agree to the <a href="#" class="text-decoration-underline" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a></label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
                            <i class="fas fa-user-plus me-2"></i>Register as Student
                        </button>
                    </form>

                    <!-- Admin Registration Form (initially hidden) -->
                    <form id="adminRegisterForm" style="display: none;">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="adminFullName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="adminFullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="adminRegEmail" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="adminRegEmail" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="adminPhone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="adminPhone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="adminIC" class="form-label">IC Number</label>
                                <input type="text" class="form-control" id="adminIC" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="adminRegPassword" class="form-label">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="adminRegPassword" required>
                                    <button class="btn btn-outline-secondary toggle-password" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <div class="form-text">
                                    <ul class="list-unstyled mb-0 small text-muted ps-3">
                                        <li id="adminPwdHintLen" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Minimum 8 characters
                                        </li>
                                        <li id="adminPwdHintUpper" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Must include 1 uppercase
                                        </li>
                                        <li id="adminPwdHintNum" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Must include 1 number
                                        </li>
                                        <li id="adminPwdHintSpecial" class="d-flex align-items-center">
                                            <i class="fas fa-circle me-2 hint-icon" style="font-size:6px;"></i>Must include 1 special character
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label for="confirmAdminPassword" class="form-label">Confirm Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="confirmAdminPassword" required>
                                    <button class="btn btn-outline-secondary toggle-password" type="button">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="adminAgree">
                            <label class="form-check-label" for="adminAgree">I agree to the <a href="#" class="text-decoration-underline" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a></label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
                            <i class="fas fa-user-shield me-2"></i>Register as Admin
                        </button>
                    </form>

                    <div class="text-center mt-3">
                        <span>Already have an account? </span>
                        <a href="#" id="showLogin" class="text-decoration-none">Login here</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase init -->
    <script type="module" src="js/firebase-init.js"></script>

    <!-- Auth JavaScript -->
    <script src="js/auth.js"></script>
    
    <!-- Page Modules -->
    <script src="js/pages/profile.js"></script>
    <script src="js/pages/attendance.js"></script>
    <script src="js/pages/students.js"></script>
    <script src="js/pages/programs.js"></script>
    <script src="js/pages/activity-logs.js"></script>
    <script src="js/pages/announcements.js"></script>
    <script src="js/pages/verify.js"></script>
    
    <!-- Core Application -->
    <script src="js/components/navigation.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // Initialize the application when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the application
            App.init();
            
            // Toggle between login and register modals
            const showRegister = document.getElementById('showRegister');
            const showLogin = document.getElementById('showLogin');
            
            if (showRegister && showLogin) {
                showRegister.addEventListener('click', function(e) {
                    e.preventDefault();
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    const registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
                    
                    // Blur any focused element before hiding to prevent aria-hidden focus issues
                    if (document.activeElement && document.activeElement.blur) {
                        document.activeElement.blur();
                    }
                    if (loginModal) loginModal.hide();
                    registerModal.show();
                    // Move focus into the new modal
                    setTimeout(() => {
                        document.getElementById('studentFullName')?.focus();
                    }, 0);
                });
                
                showLogin.addEventListener('click', function(e) {
                    e.preventDefault();
                    const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    
                    // Blur any focused element before hiding to prevent aria-hidden focus issues
                    if (document.activeElement && document.activeElement.blur) {
                        document.activeElement.blur();
                    }
                    if (registerModal) registerModal.hide();
                    loginModal.show();
                    // Move focus into the new modal
                    setTimeout(() => {
                        const isStudentLogin = document.getElementById('studentLogin')?.checked;
                        if (isStudentLogin) {
                            document.getElementById('studentEmail')?.focus();
                        } else {
                            document.getElementById('adminEmail')?.focus();
                        }
                    }, 0);
                });
            }
        });
    </script>
</body>
</html>
